1

S 0 -> COPY_INPUT 0 >
S 1 -> COPY_INPUT 1 >

COPY_INPUT 0 -> COPY_INPUT 0 >
COPY_INPUT 1 -> COPY_INPUT 1 >
COPY_INPUT _ -> MARK_END $ <

MARK_END 0 -> MARK_END 0 <
MARK_END 1 -> MARK_END 1 <
MARK_END $ -> MARK_END $ <
MARK_END _ -> GOTO_START # >

GOTO_START 0 -> GOTO_START 0 >
GOTO_START 1 -> GOTO_START 1 >
GOTO_START $ -> COPY_COUNTER $ >

COPY_COUNTER 0 -> COPY_0 # >
COPY_COUNTER 1 -> COPY_1 # >

COPY_0 0 -> COPY_0 0 >
COPY_0 1 -> COPY_0 1 >
COPY_0 # -> COPY_0 # >
COPY_0 _ -> SET_RESULT 0 <

COPY_1 0 -> COPY_1 0 >
COPY_1 1 -> COPY_1 1 >
COPY_1 # -> COPY_1 # >
COPY_1 _ -> SET_RESULT 1 <

SET_RESULT # -> SET_RESULT # <
SET_RESULT 0 -> SET_RESULT 0 <
SET_RESULT 1 -> SET_RESULT 1 <
SET_RESULT _ -> LOOP_START # >

LOOP_START # -> CHECK_COUNTER # >

CHECK_COUNTER 0 -> GOTO_MULTIPLY 0 >
CHECK_COUNTER 1 -> CHECK_IF_ONE 1 >

CHECK_IF_ONE 0 -> GOTO_MULTIPLY 0 >
CHECK_IF_ONE 1 -> CHECK_IF_ONE 1 >
CHECK_IF_ONE # -> CHECK_IF_ONE_RESULT # >

CHECK_IF_ONE_RESULT 0 -> GOTO_MULTIPLY 0 <
CHECK_IF_ONE_RESULT 1 -> CHECK_IF_DONE 1 >
CHECK_IF_ONE_RESULT _ -> CHECK_IF_DONE _ >

CHECK_IF_DONE 0 -> GOTO_MULTIPLY 0 <
CHECK_IF_DONE 1 -> GOTO_MULTIPLY 1 <
CHECK_IF_DONE # -> CLEANUP # <
CHECK_IF_DONE _ -> CLEANUP _ <

GOTO_MULTIPLY 0 -> GOTO_MULTIPLY 0 >
GOTO_MULTIPLY 1 -> GOTO_MULTIPLY 1 >
GOTO_MULTIPLY # -> MULTIPLY_START # <

MULTIPLY_START # -> MULTIPLY # >

MULTIPLY 0 -> NEXT_BIT 0 > 
MULTIPLY 1 -> ADD_RESULT 1 >

ADD_RESULT # -> ADD_RESULT # >
ADD_RESULT 0 -> ADD_0 0 >
ADD_RESULT 1 -> ADD_1 1 >
ADD_RESULT _ -> ADD_DONE _ <

ADD_0 0 -> ADD_0 0 >
ADD_0 1 -> ADD_0 1 >
ADD_0 _ -> ADD_DONE 0 <

ADD_1 0 -> ADD_1 0 >
ADD_1 1 -> ADD_1 1 >
ADD_1 _ -> ADD_DONE 1 <

ADD_DONE 0 -> ADD_DONE 0 <
ADD_DONE 1 -> ADD_DONE 1 <
ADD_DONE # -> NEXT_BIT # >

NEXT_BIT 0 -> NEXT_BIT 0 >
NEXT_BIT 1 -> NEXT_BIT 1 >
NEXT_BIT # -> DONE_MULTIPLY # <

DONE_MULTIPLY # -> DECREMENT # <

DECREMENT 0 -> BORROW 1 <
DECREMENT 1 -> DEC_DONE 0 <
DECREMENT # -> DECREMENT # <

BORROW 0 -> BORROW 1 <
BORROW 1 -> DEC_DONE 0 <
BORROW # -> DEC_DONE # >

DEC_DONE 0 -> DEC_DONE 0 >
DEC_DONE 1 -> DEC_DONE 1 >
DEC_DONE # -> LOOP_START # <

CLEANUP # -> CLEANUP _ <
CLEANUP 0 -> CLEANUP 0 <
CLEANUP 1 -> CLEANUP 1 <
CLEANUP $ -> FORMAT_RESULT _ <

FORMAT_RESULT # -> FORMAT_RESULT _ <
FORMAT_RESULT 0 -> SKIP_ZEROS 0 <
FORMAT_RESULT 1 -> DONE 1 ^

SKIP_ZEROS 0 -> SKIP_ZEROS _ <
SKIP_ZEROS 1 -> DONE 1 ^
SKIP_ZEROS _ -> DONE_EMPTY _ >

DONE_EMPTY _ -> DONE 0 ^

DONE 0 -> DONE 0 ^
DONE 1 -> DONE 1 ^